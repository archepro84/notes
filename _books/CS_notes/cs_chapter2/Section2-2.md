# Chapter 2 Network(네트워크)

# Section 2.2 TCP/IP 4계층 모델

## 개론

> 💡 **TCP/IP(Transmission Control Protocol/Internet Protocol)는** 인터넷에서 컴퓨터들이 서로 정보를 주고받는 데 쓰이는 프로토콜을 설명하기 위해 사용하는 모델이다.
>

## 📌 TCP/IP 4계층 모델

### 어플리케이션(Application) 계층

- 사용자가 네트워크를 통해 서비스를 사용하기 위해 사용하는 계층
- **DNS, HTTP, FTP, SMTP, POP3, Telnet** 등이 위치하는 계층

### 전송(Transport) 계층

- 송신자와 수신자를 연결하는 통신 서비스를 제공합니다.
- 어플리케이션 계층에서 올라온 데이터를 인터넷 계층 사이의 데이터가 전달될 때 **중계 역할**을 합니다.
- **TCP, UDP** 프로토콜이 위치하는 계층

### 인터넷(Internet) 계층

- 전달받은 네트워크 패킷을 IP주소로 지정된 목적지로 전송하기 위해 사용하는 계층
- 패킷을 수신해야 할 **상대의 주소를 지정**하여 데이터를 전달합니다.
- **IP, ICMP, ARP, RARP** 프로토콜이 위치하는 계층

### 링크(Link) 계층 | 네트워크 접근 계층

- 전선, 광섬유, 무선 등 실질적으로 데이터를 전송하는 **물리적인 계층**
- **MAC, PPP, SLIP** 프로토콜이 위치하는 계층

## 📌 TCP 3-웨이 핸드 셰이크(3-way handshake)

- TCP는 **신뢰성 있는** 데이터 전송을 위해 **연결형 서비스** 를 제공합니다.
- `SYN`이란 **Synchronize Sequence Numbers**의 약자로, TCP 통신을 시작하기 위한 **연결 요청 플래그** 입니다.
- `ISN`이란 **Initial Sequence Number**의 약자로, 처음 네트워크 연결을 할 때 할당된 32비트 고유 시퀀스 번호입니다.
- `ACK`란 **ACKnowledgement**의 약자로, **응답 플래그** 입니다.

> 1️⃣ SYN: 클라이언트는 서버에 클라이언트의 ISN을 담아 SYN 전송합니다.
>

> 2️⃣ SYN + ACK: 서버는 클라이언트의 SYN을 수신하고, ISN에 1을 더한 값을 ISN으로 하여 전달합니다.
>

> 3️⃣ ACK: 클라이언트는 서버의 ISN에 1을 더한 값인 승인번호를 담아 ACK를 서버에 전송합니다.
>

## 📌 TCP 4-웨이 핸드 셰이크(4-way handshake)

- TCP 연결을 종료하기 위해 사용하는 **연결 해제** 방법입니다.

> 1️⃣ FIN: 클라이언트는 서버에 연결을 종료하겠다는 **FIN**을 전송합니다.  
> 클라이언트: `FIN_WAIT_1` 상태로 변경되고, 서버의 응답을 기다립니다.
>

> 2️⃣ ACK: 서버는 클라이언트의 **FIN**을 수신하고, 클라이언트의 승인번호를 담아 **ACK**를 전송합니다.  
> 서버: `CLOSE_WAIT` 상태로 변경됩니다.  
> 클라이언트: 서버의 **ACK**를 수신하고, `FIN_WAIT_2` 상태로 변경됩니다.

> 3️⃣ FIN: 서버는 클라이언트에게 연결을 종료하겠다는 **FIN**을 전송합니다.  
> 서버: `LAST_ACK` 상태로 변경됩니다.  
> 클라이언트: 서버의 **FIN**을 수신하고, `TIME_WAIT` 상태로 변경됩니다.
>

> 4️⃣ ACK: 클라이언트는 서버의 **FIN**을 수신하고, 서버의 승인번호를 담아 **ACK**를 전송합니다.  
> 이후 클라이언트는 일정 시간을 대기한 후 서버와의 연결을 해제합니다.
>

### 📒 TCP 4-way handshake `TIME_WAIT` 상태 알아보기

- `TIME_WAIT` 상태는 클라이언트가 서버에게 **ACK**를 보내고, 일정 시간을 대기한 후 연결을 해제하는 과정입니다.
- 지연 패킷이 발생할 경우 패킷이 뒤늦게 도달하고 처리하지 못하는 데이터 무결성 문제를 대비하기 위해 사용합니다.
- `LAST_ACK` 상태에서 연결이 닫히게 될 경우 새로운 연결을 하려고 할 때, `LAST_ACK`로 되어있어 서버가 클라이언트의 연결을 받아들이지 않을 수 있습니다.

## 📌 전이중화, 반이중화 통신

### 전이중화(full duplex) 통신

- **양방향으로 동시에 통신**이 가능한 통신 방식입니다.
- 송신로와 수신로로 나누어 데이터를 주고받으며, 고속 이너뎃은 **전이중화 통신**을 기반으로 구성되어 있습니다.
- 예시: 전화 통화

### 반이중화(half) 통신

- 양방향으로 동시에 통신이 불가능하고, **한 번에 한 방향**만 통신할 수 있는 방식입니다.
- 장치에서 신호를 수신하려 한다면, 전송이 완료될 때까지 응답을 대기해야합니다.
- 둘 이상의 장치가 동시에 데이터를 전송한다면 메시지가 손실되거나 왜곡될 수 있으므로 **충돌 방지 시스템**이 필요합니다.
- 예시: 라디오 방송

### CSMA/CA

- **Carrier Sense Multiple Access with Collision Avoidance**의 약자로, **CSMA**와 **CSMA/CD**의 합성어입니다.
- 데이터를 보내기 전에 캐리어 감지 등으로 사전에 가능한 한 충돌을 방지하는 방식을 사용합니다.

1. 데이터를 송신하기 전에 무선 매체를 살펴봅니다.
2. 캐리어 감지: 회선이 비어 있는지 판단합니다.
3. IFS(Inter FrameSpace): 랜덤 값을 기반으로 정해진 시간만큼 기다리며, 만약 현재 무선 매체가 사용 중이라면, 그 간격을 늘려가며 기다립니다.
4. 무선 매체가 사용하지 않고 있을 때, 데이터를 송신합니다.

### 📒 계층 간 데이터 송수신 과정 정리하기

> 1️⃣ **데이터 전송:** 어플리케이션 계층 -> 전송 계층 -> 인터넷 계층 -> 링크 계층 ->
>

> 2️⃣ 링크 계층 -> 인터넷 계층 -> 전송 계층 -> 어플리케이션 계층 **:데이터 수신**
>

- **캡슐화 과정**
    - 상위 계층의 헤더(Header)와 하위 계층에 데이터 부분을 병합하고, **해당 계층에 헤더를 삽입**하는 과정입니다.
    - 헤더는 데이터를 전송하는데 필요한 정보를 담고 있습니다.
- **비캡슐화 과정**
    - 헤더의 정보를 이용하여 데이터를 전송하는데 필요한 정보를 **추출**하는 과정입니다.
    - 데이터 수신 측에서 캡슐화된 데이터를 받게 되면, 헤더를 제거하고, **데이터를 추출**합니다.

### 📒 PDU (Protocol Data Unit)

- 프로토콜에서 데이터를 주고받을 때, **프로토콜에 의해 정의된 데이터 단위**를 의미합니다.
- PDU는 제어와 관련된 정보들이 포함된 **"헤더(Header)"**, 데이터를 의미하는 **"페이로드(Payload)"** 로 구성되어 있습니다.
    - 어플리케이션 계층 (Application Layer) : 메시지(Message)
    - 전송 계층 (Transport Layer) : 세그먼트(Segment)|TCP, 데이터그램(Datagram)|UDP
    - 인터넷 계층 (Internet Layer) : 패킷(Packet)
    - 링크 계층 (Link Layer) : 프레임(Frame)|데이터 링크 계층, 비트(Bit)|물리 계층